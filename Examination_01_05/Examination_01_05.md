# ---------------- `APUE` 阶段性检测 -------------
* **检测范围: Chapter 1 ~ Chapter 5**

* **题型：填空题、画图题、编程题、实验探究题**

* **试卷满分：300分**
****

### 一、填空题（50分）
1. 请为右侧名词作出定义，**内核**是 ____、**系统调用（`system call`）**是 _____、**公用库函数**是 ___、**`shell`** 是 _____
2. 在 `Linux` 操作系统中，用户的登录名取自 ______ 文件中的登陆项，此登陆项中包含有下列信息：________、 _________、 _________、 ________、 ________、 ________、 ________
3. 目录是一种包含 _________ 的文件，每个（**前一个空的答案**） _________ 至少包含 _________ 和 ___________
4. 请描述 `相对路径` 和 `绝对路径` 的区别：_____
5. 工作目录是指 ______，改变和查看工作目录可以使用函数 _____ 和 _____（**填写函数原型**）
6. 文件描述符是指 ______、不同进程间的文件描述符 ________ （***会/不会***）相同，原因是 _____ 
7. 请辨析 `程序` 和 `进程`：____________________________
8. 不同进程中的线程 ID __________ （**会/不会**）相同。
6. 描述 `shell` 命令 `prog1 < inputfile | prog2 | prog3 > outputfile` 的作用  __________________________。
7. 信号的作用是 ________________________________、操作系统有三种处理信号的方式，分别为 ____________________________、________、___________。为相应的信号注册捕获函数可以使用 ______ （***填写函数原型***），______（***填写函数原型***）。
7. `wall clock time` 指的是 ______________________、`用户 CPU 时间` 指的是 _________________________、`系统 CPU 时间`指的是 _________________________。 
8. `带缓冲的 I/O` 一词中，`缓冲`指的是 ____，`带缓冲的 I/O` 其优势在于：______________________________________________________________
9. 分别解释下列标志位的作用：`O_EXCL`，`O_APPEND`，`O_TRUNC`，
`O_SYNC`，`O_DSYNC`，`O_NONFOLLOW` ______________________________
10. 描述两种获取文件大小的方式 ______________________________________
11. 列举使 `read` 返回字节数小于 `0` 的情况（至少列举一种）_____________
12. 列举使 `read` 返回字节数小于应读取字节数的情况（至少列举两种）________
15. `creat` 相当于调用 `open(file_path`, _______, `flags)`
16. 对于 `read` 和 `write` 缓冲区尺寸的选取，最恰当的选择是 ____________ 
17. 列举所有文件类型和判断该类型的宏，并分别对其作一定的介绍或阐述其用途 ____
18. 尽可能多的列举 `struct stat` 中的字段，并分别对其作一些介绍 _________

### 二、画图题
> 要求：画出`进程表项`，`文件表项`和 `v节点表项`以及 `i节点`，并用有方向的箭头绘制出它们之间的逻辑关系。

1. 画出同一进程打开两个不同文件的内核数据结构。
2. 画出两个不同进程各自打开同一文件的内核数据结构。
3. 画出 `dup(1)` 之后的内核数据结构（假设在此期间该进程没有打开任何文件）。
4. 画出 `./a.out > outfile 2>&1` 命令在执行期间的一系列内核数据结构变化（假设在此期间该进程没有打开任何文件）。
5. 画出 `./a.out 2>&1 > outfile` 命令在执行期间的一系列内核数据结构变化（假设在此期间该进程没有打开任何文件）。

-
### 三、编程题（80分）

1、 实现下列代码中所需的宏函数 `LOG(format, ...)` ，并将其编写在文件 `exam_prog1.c` 中，按如下所示导入头文件，编译运行程序，完成如图所示的输出。 

```C
#include "exam_prog1.c"

int main(int argc, char *argv[]) {
	
	char buf[10 << 10] = { 0 };
    setvbuf(stdout, buf, _IOFBF, sizeof(buf));
    printf(" ShenZheng, ");
    printf("Nice to meet you\n");
    
    LOG("Good morning, ");
    LOG("I'm %s, and I live in", "Hanson");
    char *ptr = NULL;
    LOG(ptr);

    fflush(stdout);
    _exit(0);    
}
```

***输出如下***
![](/Users/bot/Desktop/APUE/APUE/APUE_Examination_01_05/pro1.input.png)

2、使用 `dup(int fd)` 实现 `my_dup2(int fd)` 函数，并将其编写在文件 `exam_prog2.c` 中，按如下方式导入头文件，编译运行程序，完成如图所示的输出。

```C
#include "exam_prog2.c"

int main(int argc, char *argv[]) {
    
    close(2);
    if (my_dup2(2, 5) < 0) 
        printf("my_dup2 fail 1: %s\n", strerror(errno));
    else
        printf("my_dup2 succ 1\n");

    if (my_dup2(1, 1000) < 0) 
        printf("my_dup2 fail 2: %s\n", strerror(errno));
    else
        printf("my_dup2 succ 2\n");

    int fd = open("test_file", O_RDWR | O_CREAT | O_TRUNC, 0644);
    if (my_dup2(1, fd) < 0)
        printf("my_dup2 fail 3: %s\n", strerror(errno));
    else
        printf("my_dup2 succ 3\n");

    const char *ptr = "hello world to stdout\n";
    write(fd, ptr, strlen(ptr));

    if (my_dup2(1, 1) < 0)
        printf("my_dup2 fail 4: %s\n", strerror(errno));
    else
        printf("my_dup2 succ 4\n");
    
    return 0;    
}
```

![](/Users/bot/Desktop/APUE/APUE/APUE_Examination_01_05/prog2.input.png )

### 四、实验探究题（80分）

> 下面各题均需提交完整可编译运行的代码文件。

1. 列举三种使 `write(...)` 调用返回 `-1` 的情形，同时列举一种使 `write(...)` 的返回值不等于需写入字节数的情形。分别用代码构建上述四种场景，编译运行程序，给出用户友好的输出提示，将代码文件命名为 `write_neg_return.c` 作为测试解答提交。
2. 列举三种使 `read(...)` 调用返回 `-1` 的情形，列举两种使 `read(...)` 返回 `0` 的情形。分别用代码构建上述五种场景，编译运行程序，给出用户友好的输出提示，将代码文件命名为 `read_neg_return.c` 和 `read_zero_return.c` 作为测试解答提交。





	
	






 
